{"version":3,"file":"commonHelpers.js","sources":["../src/js/pixabayApi.js","../src/js/index.js"],"sourcesContent":["import axios from 'axios';\n\nasync function serviceImages(page = 1, question, order = 'popular') {\n  const params = {\n    image_type: 'photo',\n    page,\n    key: '40827343-3d4cfe2da7e34096e28537a58',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: 40,\n    q: question,\n    order,\n  };\n\n  return (await axios.get('https://pixabay.com/api/', { params })).data;\n}\n\nexport { serviceImages };\n","import * as pixabayApi from './pixabayApi';\nimport 'normalize.css/normalize.css';\nimport iziToast from 'izitoast';\nimport '../css/iziToast.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nlet page;\nlet question;\nlet queryTotalHints;\nlet order = 'popular';\nconst simpleGallery = new SimpleLightbox('.gallery a');\nlet isObserverAlloved = false;\nlet intervalId;\n\nconst elements = {\n  form: document.querySelector('.search-form'),\n  gallery: document.querySelector('.gallery'),\n  popularBtn: document.querySelector('[name=\"popular\"]'),\n  latestBtn: document.querySelector('[name=\"latest\"]'),\n  target: document.querySelector('.target'),\n};\n\nlet observerOptions = {\n  rootMargin: '200px',\n  threshold: 1.0,\n};\n\nconst observer = new IntersectionObserver(handlerLoadMore, observerOptions);\nobserver.observe(elements.target);\n\naddEventListener('wheel', () => clearInterval(intervalId));\n\naddEventListener('click', () => clearInterval(intervalId));\n\naddEventListener('scrollend', () => {\n  if (window.scrollY + window.innerHeight + 1 > document.body.scrollHeight) {\n    clearInterval(intervalId);\n  }\n});\n\nelements.popularBtn.addEventListener('click', handlerChangeOrder);\n\nelements.latestBtn.addEventListener('click', handlerChangeOrder);\n\nfunction handlerChangeOrder(ev) {\n  const currBtn = ev.target;\n\n  if (currBtn.name === order) {\n    return;\n  }\n\n  if (!question) {\n    order = currBtn.name;\n    changeSelectedClassToBtn(currBtn.name);\n    return;\n  }\n\n  page = 1;\n\n  order = currBtn.name;\n\n  isObserverAlloved = false;\n\n  pixabayApi\n    .serviceImages(page, question, order)\n    .then(({ hits, totalHits }) => {\n      queryTotalHints = totalHits;\n\n      elements.gallery.innerHTML = createMarkup(hits);\n\n      simpleGallery.refresh();\n\n      clearInterval(intervalId);\n\n      runScrolling();\n\n      setTimeout(() => (isObserverAlloved = true), 3000);\n    })\n    .catch(err => console.log(err));\n\n  changeSelectedClassToBtn(currBtn.name);\n}\n\nfunction handlerLoadMore(ev) {\n  if (page > Math.ceil(queryTotalHints / 40) || !isObserverAlloved) {\n    return;\n  }\n\n  page++;\n\n  pixabayApi\n    .serviceImages(page, question, order)\n    .then(({ hits, totalHits }) => {\n      queryTotalHints = totalHits;\n\n      elements.gallery.insertAdjacentHTML('beforeend', createMarkup(hits));\n\n      simpleGallery.refresh();\n\n      clearInterval(intervalId);\n\n      runScrolling();\n\n      if (page === Math.ceil(totalHits / 40)) {\n        showMessage(\n          'warning',\n          'bottomCenter',\n          \"We're sorry,\",\n          `but you've reached the end of search results.`\n        );\n      }\n    })\n    .catch(err => console.log(err));\n}\n\nelements.form.addEventListener('submit', handlerSubmit);\n\nfunction handlerSubmit(ev) {\n  ev.preventDefault();\n\n  if (ev.currentTarget.elements.searchQuery.value) {\n    page = 1;\n\n    isObserverAlloved = false;\n\n    question = ev.currentTarget.elements.searchQuery.value;\n\n    pixabayApi\n      .serviceImages(page, question, order)\n      .then(({ hits, totalHits } = {}) => {\n        if (totalHits > 0) {\n          queryTotalHints = totalHits;\n\n          elements.gallery.innerHTML = createMarkup(hits);\n\n          simpleGallery.refresh();\n\n          showMessage(\n            'success',\n            'topLeft',\n            'Hooray!',\n            `We found ${totalHits} images.`\n          );\n\n          setTimeout(() => (isObserverAlloved = true), 3000);\n\n          clearInterval(intervalId);\n\n          runScrolling();\n        } else {\n          showMessage(\n            'warning',\n            'center',\n            'Sorry,',\n            `there are no images matching your search query. Please try again.`\n          );\n\n          elements.gallery.innerHTML = '';\n        }\n      })\n      .catch(err => console.log(err.message));\n  }\n}\n\nfunction createMarkup(photoArr) {\n  return photoArr\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        comments,\n        downloads,\n        views,\n        likes,\n      }) => `\n        <div class=\"photo-card\">\n         <a href=\"${largeImageURL}\"><img src=\"${webformatURL}\" alt=\"${tags}\" />\n            <div class=\"info\">\n            <p class=\"info-item\">\n              <b>Likes</b> ${likes}\n            </p>\n            <p class=\"info-item\">\n              <b>Views</b> ${views}\n            </p>\n            <p class=\"info-item\">\n              <b>Comments</b> ${comments}\n            </p>\n            <p class=\"info-item\">\n              <b>Downloads</b> ${downloads}\n            </p>\n          </div></a>\n          </div>\n    `\n    )\n    .join('');\n}\n\nfunction changeSelectedClassToBtn(name) {\n  elements.latestBtn.classList.toggle('active-btn', name === 'latest');\n  elements.popularBtn.classList.toggle('active-btn', name === 'popular');\n}\n\nfunction showMessage(type, position, title, message) {\n  iziToast[type]({\n    position,\n    title,\n    message,\n  });\n}\n\nfunction runScrolling() {\n  let position = window.scrollY;\n  intervalId = setInterval(() => {\n    window.scroll(0, position);\n    position += 1;\n  }, 20);\n}\n"],"names":["serviceImages","page","question","order","params","axios","queryTotalHints","simpleGallery","SimpleLightbox","isObserverAlloved","intervalId","elements","observerOptions","observer","handlerLoadMore","handlerChangeOrder","ev","currBtn","changeSelectedClassToBtn","pixabayApi\n    .serviceImages","hits","totalHits","createMarkup","runScrolling","err","showMessage","handlerSubmit","pixabayApi\n      .serviceImages","photoArr","webformatURL","largeImageURL","tags","comments","downloads","views","likes","name","type","position","title","message","iziToast"],"mappings":"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"}